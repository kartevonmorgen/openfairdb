[package]
name = "openfairdb"
version = "0.10.5"
authors = ["Markus Kohlhase <mail@markus-kohlhase.de>", "slowtec GmbH <post@slowtec.de>"]
keywords = ["geo", "fair", "sustainability"]
homepage = "https://github.com/kartevonmorgen/openfairdb"
repository = "https://github.com/kartevonmorgen/openfairdb"
license = "AGPL-3.0-or-later"
edition = "2021"

[workspace]
members = [
  "ofdb-boundary",
  "ofdb-core",
  "ofdb-db-sqlite",
  "ofdb-entities",
  "ofdb-gateways",
]
exclude = [ "ofdb-app-clearance" ]

[patch.crates-io]
ofdb-boundary  = { path = "./ofdb-boundary"  }
ofdb-core      = { path = "./ofdb-core"      }
ofdb-db-sqlite = { path = "./ofdb-db-sqlite" }
ofdb-entities  = { path = "./ofdb-entities"  }
ofdb-gateways  = { path = "./ofdb-gateways"  }

[dependencies]
ofdb-boundary = { version = "=0.10.1", features = ["extra-derive"] }
ofdb-core = "=0.0.0"
ofdb-db-sqlite = "=0.0.0"
ofdb-entities = { version = "=0.10.1", features = ["url"] }
ofdb-gateways = "=0.0.0"

anyhow = "1.0.58"
base64 = { version = "0.13.0", optional = true }
captcha = "0.0.9"
clap =  { version = "3.2.12", features = ["cargo"] }
csv = "1.1.6"
dotenv = "0.15.0"
env_logger = "0.9.0"
fast_chemail = "0.9.6"
jsonwebtoken = { version = "8.1.1", optional = true }
lazy_static = "1.4.0"
log = "0.4.17"
num-traits = "0.2.15"
maud = { version = "0.23.0", optional = true, features = ["rocket"] }
parking_lot = "0.12.1"
passwords = "3.1.9"
pwhash = "1.0.0"
rand = { version = "0.8.5", optional = true }
r2d2 = ">=0.8.10,<0.9"
regex = "1.6.0"
rust-embed = "6.4.0"
rocket = { version = "0.5.0-rc.2", features = ["secrets", "json"] }
rocket_cors = "0.6.0-alpha1"
serde = { version = "1.0.139", features = ["derive"] }
serde_json = "1.0.82"
strum = "0.24.1"
tantivy = "0.18.0"
time = { version = "0.3.11", features = ["macros", "formatting"] }
tokio = "1.20.0"
thiserror = "1.0.31"
uuid = { version = "1.1.2", features = ["v4"] }

[patch.crates-io.maud]
# TODO: use v0.24.0 as soon as it's published
git = "https://github.com/slowtec/maud"
branch = "rocket-0.5.0-rc.2"

[patch.crates-io.rocket_cors]
# TODO: use v0.6.0 as soon as it's published
git = "https://github.com/lawliet89/rocket_cors.git"
branch = "master"

[patch.crates-io.geocoding]
# TODO: use upstream as soon as https://github.com/georust/geocoding/pull/57 is merged.
git = "https://github.com/slowtec/geocoding"
branch = "remove-chrono"

[dev-dependencies]
rand = "0.8.5"
ofdb-entities = { version = "*", features = ["builders"] }

[build-dependencies]
walkdir = "2.3.2"

[features]
default = ["frontend", "email", "clearance", "cookies", "jwt"]

clearance = []
cookies = []
email = []
frontend = ["maud"]
jwt = ["jsonwebtoken", "base64", "rand"]

[profile.release]
lto = true
opt-level = 3
codegen-units = 1
