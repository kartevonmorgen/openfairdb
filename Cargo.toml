[package]
name = "openfairdb"
version.workspace = true
edition.workspace = true

[workspace.package]
version = "0.12.3"
repository = "https://github.com/kartevonmorgen/openfairdb"
homepage = "https://github.com/kartevonmorgen/openfairdb"
keywords = ["geo", "fair", "sustainability"]
authors = ["slowtec GmbH <post@slowtec.de>"]
license = "AGPL-3.0-or-later"
edition = "2021"
rust-version = "1.66.0"

[workspace]
members = [
  "ofdb-application",
  "ofdb-boundary",
  "ofdb-core",
  "ofdb-db-sqlite",
  "ofdb-db-tantivy",
  "ofdb-entities",
  "ofdb-gateways",
  "ofdb-seed",
  "ofdb-webserver",
]
exclude = [ "ofdb-app-clearance" ]

[patch.crates-io]
ofdb-application = { path = "./ofdb-application" }
ofdb-boundary    = { path = "./ofdb-boundary"    }
ofdb-core        = { path = "./ofdb-core"        }
ofdb-db-sqlite   = { path = "./ofdb-db-sqlite"   }
ofdb-db-tantivy  = { path = "./ofdb-db-tantivy"  }
ofdb-entities    = { path = "./ofdb-entities"    }
ofdb-gateways    = { path = "./ofdb-gateways"    }
ofdb-seed        = { path = "./ofdb-seed"        }
ofdb-webserver   = { path = "./ofdb-webserver"   }

[dependencies]
ofdb-application = "=0.0.0"
ofdb-core        = "=0.0.0"
ofdb-db-sqlite   = "=0.0.0"
ofdb-db-tantivy  = "=0.0.0"
ofdb-gateways    = "=0.0.0"
ofdb-webserver   = "=0.0.0"

ofdb-entities    =  "*"

anyhow = "1.0.68"
clap = { version = "4.1.1", features = ["cargo", "derive"] }
dotenv = "0.15.0"
duration-str = { version = "0.5.0", default-features = false, features = ["serde"] }
env_logger = "0.10.0"
log = "0.4.17"
serde = { version = "1.0.152", features = ["derive"] }
time = "0.3.17"
tokio = "1.24.2"
toml = "0.5.10"

[patch.crates-io.maud]
# TODO: use v0.25.0 as soon as it's published
git = "https://github.com/slowtec/maud"
branch = "rocket-0.5.0-rc.2"

[patch.crates-io.rocket_cors]
# TODO: use v0.6.0 as soon as it's published
git = "https://github.com/lawliet89/rocket_cors.git"
branch = "master"

[patch.crates-io.geocoding]
# TODO: use upstream as soon as https://github.com/georust/geocoding/pull/58 is merged.
git = "https://github.com/slowtec/geocoding"
branch = "remove-reqwest-default-tls-feature"

[patch.crates-io.rocket]
# TODO: use upstream as soon as v0.5 is published
git = "https://github.com/slowtec/Rocket"
branch = "fixes"

[dev-dependencies]
rand = "0.8.5"
ofdb-entities = { version = "*", features = ["builders"] }

[profile.dev]
opt-level = 2
# TODO: Uncomment after
# <https://github.com/rust-lang/cargo/pull/11347>
# has been merged and released in stable.
#split-debuginfo = "unpacked"

[profile.test]
inherits = "dev"

[profile.release]
opt-level = 3
lto = "thin"
strip = "debuginfo"

[profile.profiling]
inherits = "release"
# Keep debug symbols for profiling -> results in huge binary!
debug = true

[profile.production]
inherits = "release"
lto = true
codegen-units = 1
strip = true
panic = "abort"
